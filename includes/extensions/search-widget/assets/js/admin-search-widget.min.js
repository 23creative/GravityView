!function($){var gvSearchWidget={dialog:null,selectFields:null,wp_widget_id:"gravityview_search",init:function(){$("body").on("dialogopen",'[data-fieldid="search_bar"] .gv-dialog-options',gvSearchWidget.openDialog).on("click",".gv-dialog-options a[href='#addSearchField']",gvSearchWidget.addField).on("click",".gv-dialog-options a[href='#removeSearchField']",gvSearchWidget.removeField).on("change",".gv-dialog-options select.gv-search-fields",gvSearchWidget.updateRow).on("sortcreate sortupdate sort",".gv-dialog-options table",gvSearchWidget.zebraStripe).on("dialogbeforeclose",'[data-fieldid="search_bar"] .gv-dialog-options',gvSearchWidget.updateOnClose).on("#gravityview_form_id, #gravityview_directory_template").change(gvSearchWidget.clearCache)},wp_widget_init:function(){$("body").on("click",".widget[id*='gravityview_search'] a[href='#gv-search-settings'], .widget-inside a[href='#gv-search-settings']",function(){$(this).parents('[data-fieldid="search_bar"]').trigger("dblclick")}).on("change",'[data-fieldid="search_bar"] .gv-dialog-options',gvSearchWidget.updateOnClose).on("#gravityview_view_id").change(gvSearchWidget.wp_widget_show_settings_link),$(document).on("click.widgets-toggle","body",gvSearchWidget.wp_widget_open),$(document).on("widget-added widget-updated",gvSearchWidget.wp_widget_save)},is_wp_widget:function(widget){return $(widget).is("[id*="+gvSearchWidget.wp_widget_id+"]")},wp_widget_open:function(e){var widget,target=$(e.target);target.parents(".widget-top").length&&!target.parents("#available-widgets").length&&(widget=target.closest("div.widget"),gvSearchWidget.is_wp_widget(widget)&&$("#gravityview_view_id").trigger("change"))},wp_widget_save:function(e,widget){gvSearchWidget.is_wp_widget(widget)&&$("#gravityview_view_id").trigger("change")},wp_widget_show_settings_link:function(e){var value=$(e.target).val(),$link=$(e.target).parents(".widget-content").find("#gv-widget-search-settings-link");value.length>0?$link.slideDown():$link.slideUp()},openDialog:function(e){e.preventDefault(),gvSearchWidget.dialog=$(this),gvSearchWidget.renderUI($(this).parents(".gv-fields"))},addField:function(e){e.preventDefault();var table=$(this).parents("table"),row=$(this).parents("tr");return row.hasClass("no-search-fields")&&(row.remove(),row=null),gvSearchWidget.addRow(table,row,null),!1},removeField:function(e){e.preventDefault();var table=$(this).parents("table");return $(this).parents("tr").fadeTo("normal",.4,function(){$(this).remove(),$("tr.gv-search-field-row",table).length<1&&$("tr.no-search-fields",table).length<1&&gvSearchWidget.addEmptyMsg(table),gvSearchWidget.updateAvailableFields(),gvSearchWidget.styleRow(table)}),!1},renderUI:function(parent){var fields=$(".gv-search-fields-value",parent).val();return null===gvSearchWidget.selectFields?(gvSearchWidget.dialog.append('<p id="gv-loading"><span class="spinner"></span>'+gvGlobals.loading_text+"</p>"),void gvSearchWidget.getSelectFields(parent)):void($("table",gvSearchWidget.dialog).length&&$("#gv-loading").length<1||(table=gvSearchWidget.addTable(),0===fields.length?gvSearchWidget.addRow(table,null,null):gvSearchWidget.populateRows(table,fields),gvSearchWidget.dialog.append(table),gvSearchWidget.dialog.find("table tbody").sortable({start:function(event,ui){$(ui.item).removeClass("alt")}}),gvSearchWidget.updateAvailableFields(),$("#gv-loading").remove()))},zebraStripe:function(){$(gvSearchWidget.dialog).find("tr.gv-search-field-row").removeClass("alt").filter(":even").addClass("alt")},populateRows:function(table,fields){var rows=$.parseJSON(fields),pos=null;return 0===rows.length?void gvSearchWidget.addEmptyMsg(table):void $.each(rows,function(i,values){gvSearchWidget.addRow(table,pos,values),pos=table.find("tbody tr:last")})},addTable:function(){return $('<table class="form-table widefat"><thead><tr><th class="cell-sort">&nbsp;</th><th class="cell-search-fields">'+gvSearchVar.label_searchfield+'</th><th class="cell-input-types">'+gvSearchVar.label_inputtype+'</th><th class="cell-add-remove">&nbsp;</th></tr></thead><tbody></tbody></table>')},addEmptyMsg:function(table){$(table).append('<tr class="no-search-fields"><td colspan="4">'+gvSearchVar.label_nofields+'&nbsp; <a href="#addSearchField">'+gvSearchVar.label_addfield+"</a></td></tr>")},addRow:function(table,row,curr){var rowString=$('<tr class="gv-search-field-row new-row hide-if-js" />').append('<td class="cell-sort"><span class="icon gv-icon-caret-up-down" /></td>').append('<td class="cell-search-fields">'+gvSearchWidget.getSelectFields()+"</td>").append('<td class="cell-input-types"><select class="gv-search-inputs" /></td>').append('<td class="cell-add-remove"><a href="#addSearchField" class="dashicons dashicons-plus-alt" /><a href="#removeSearchField" class="dashicons dashicons-dismiss" /></td>');null!==row&&row.length?$(row,table).after(rowString):$("tbody",table).append(rowString),table.find("tr.new-row").each(function(){$(this).removeClass("new-row"),null!==curr&&$(this).find("select.gv-search-fields").val(curr.field),gvSearchWidget.updateSelectInput($(this)),null!==curr&&$(this).find("select.gv-search-inputs").val(curr.input),$(this).fadeIn(function(){$(this).removeClass("hide-if-js")})}),gvSearchWidget.styleRow(table)},styleRow:function(){var sort_icon=$(".cell-sort .icon",gvSearchWidget.dialog);1===$("tbody tr",gvSearchWidget.dialog).length?sort_icon.fadeOut("fast",function(){$(this).parents("td").addClass("no-sort")}):sort_icon.fadeIn("fast",function(){$(this).parents("td").removeClass("no-sort")}),gvSearchWidget.zebraStripe()},updateRow:function(){var row=$(this).parents("tr");gvSearchWidget.updateSelectInput(row),gvSearchWidget.updateAvailableFields()},updateAvailableFields:function(){$("option",gvSearchWidget.selectFields).attr("disabled",null),$("tr.gv-search-field-row .gv-search-fields",gvSearchWidget.dialog).each(function(){gvSearchWidget.selectFields.find('option[value="'+$(this).val()+'"]').attr("disabled",!0)}).each(function(){var select=gvSearchWidget.selectFields.clone();select.val($(this).val()),select.find("option:selected").attr("disabled",null),$(this).replaceWith(select)})},updateSelectInput:function(tr){var type=tr.find("select.gv-search-fields option:selected").attr("data-inputtypes"),select=tr.find("select.gv-search-inputs"),options=gvSearchWidget.getSelectInput(type);select.html(options),select.prop("disabled",function(){return 1===$("option",$(this)).length})},getSelectFields:function(parent){if(null!==gvSearchWidget.selectFields)return gvSearchWidget.updateAvailableFields(),gvSearchWidget.selectFields.prop("outerHTML");var ajaxdata={action:"gv_searchable_fields",nonce:gvSearchVar.nonce,formid:$("#gravityview_form_id",parent).val(),view_id:$("#gravityview_view_id",parent).val(),template_id:$("#gravityview_directory_template",parent).val()};$.ajax({url:ajaxurl,type:"POST",async:!0,dataType:"html",data:ajaxdata,success:function(response){"0"!==response&&(gvSearchWidget.selectFields=$(response),gvSearchWidget.renderUI(parent))}})},getSelectInput:function(type){var labels=$.parseJSON(gvSearchVar.input_labels),types=$.parseJSON(gvSearchVar.input_types),options=[],inputs=gvSearchWidget.getValue(types,type);return null===inputs?"":($.each(inputs,function(k,input){var label=gvSearchWidget.getValue(labels,input);options.push('<option value="'+input+'">'+label+"</option>")}),options.join())},getValue:function(obj,key){var value=null;return $.each(obj,function(k,val){return key===k?(value=val,!1):void 0}),value},updateOnClose:function(){var configs=[];gvSearchWidget.dialog.find("table tr.gv-search-field-row").each(function(){var row={};row.field=$(this).find("select.gv-search-fields").val(),row.input=$(this).find("select.gv-search-inputs").val(),configs.push(row)}),$(".gv-search-fields-value",gvSearchWidget.dialog).val(JSON.stringify(configs))},clearCache:function(){gvSearchWidget.selectFields=null,$(".gv-search-fields-value").each(function(){$(this).parents(".gv-dialog-options").find("table").remove(),$(this).val("")})}};$(document).ready(function(){gvSearchWidget.init(),$("body").hasClass("widgets-php")&&gvSearchWidget.wp_widget_init()})}(jQuery);