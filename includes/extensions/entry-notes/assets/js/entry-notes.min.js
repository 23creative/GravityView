!function($){$.fn.shiftSelectable=function(){var lastChecked,$boxes=this;return $boxes.click(function(evt){if(!lastChecked)return void(lastChecked=this);if(evt.shiftKey){var start=$boxes.index(this),end=$boxes.index(lastChecked);$boxes.slice(Math.min(start,end),Math.max(start,end)+1).prop("checked",lastChecked.checked).trigger("change")}lastChecked=this}),this};var gv_entry_notes={init:function(){$(".gv-notes").each(function(){gv_entry_notes.setup_checkboxes($(this)),$(".gv-notes-toggle",$(this)).on("change",gv_entry_notes.toggle_all),$(".gv-notes-list",$(this)).on("submit",gv_entry_notes.delete_notes),$(".gv-note-email-to",$(this)).on("change",gv_entry_notes.email_fields_toggle).trigger("change"),$(".gv-note-add",$(this)).on("submit",gv_entry_notes.add_note).find("textarea").on("keydown",gv_entry_notes.command_enter)})},setup_checkboxes:function($container){$('input[name="note[]"]',$container).on("change",gv_entry_notes.toggle_disable_delete).shiftSelectable().filter(":first-child").trigger("change")},toggle_disable_delete:function(){$container=$(this).parents(".gv-notes"),$checkboxes=$('input[name="note[]"]',$container),$(".gv-notes-delete",$container).prop("disabled",0===$checkboxes.filter(":checked").length)},email_fields_toggle:function(){var val=$(this).val(),$email_container=$(".gv-note-email-container");$("fieldset",$email_container).toggle(""!==val),$(".gv-note-to-custom-container",$email_container).toggle("custom"===val)},command_enter:function(e){13==e.keyCode&&e.metaKey&&$(".gv-note-add").submit()},toggle_all:function(e){$container=$(this).parents(".gv-notes"),$checkboxes=$('input[name="note[]"]',$container),$checkboxes.prop("checked",$(this).prop("checked")).trigger("change")},delete_notes:function(e){e.preventDefault();var $container=$(e.target).parent(".gv-notes"),$checked=$('input[name="note[]"]:checked',$container);if(0===$checked.length)return console.log("No notes were checked"),!1;if(!window.confirm(GVEntryNotes.text.delete_confirm))return console.log("Just kidding. Please do not delete me!"),!1;var $submit=$container.find(".gv-notes-delete");$.ajax({url:GVEntryNotes.ajaxurl,isLocal:!0,method:"POST",beforeSend:function(){$container.addClass("gv-processing-note"),$submit.data("value",$submit.html()).prop("disabled",!0).html(GVEntryNotes.text.processing)},data:{action:"gv_delete_notes",data:$(this).serialize()}}).done(function(data,textStatus,jqXHR){$submit.prop("disabled",!1).html($submit.data("value")),$container.removeClass("gv-processing-note"),!0===data.success?$checked.parents("tr.gv-note").addClass("gv-note-deleted").animate({height:"0",opacity:"0"},"slow",function(){$(this).remove(),0===$("tr.gv-note",$container).length&&$container.removeClass("gv-has-notes").addClass("gv-no-notes"),$container.find(".gv-notes-toggle").prop("checked",!1),gv_entry_notes.setup_checkboxes($container)}):gv_entry_notes.show_message($submit,data.data.error)})},show_message:function($insert_after,message){var css_class="gv-note-message",message_class="gv-note-error";$message=$insert_after.next("."+css_class).length?$insert_after.next("."+css_class):$("<div/>",{"class":css_class}),$message.insertAfter($insert_after).attr("class",css_class+" "+message_class).html(message).fadeIn("fast").delay(3e3).fadeOut("fast").on("click",function(){$(this).fadeOut("fast")})},add_note:function(e){e.preventDefault();var $container=$(e.target).parent(".gv-notes"),$submit=$container.find(".gv-add-note-submit"),$inputs=$container.find(":input").not("[type=hidden]");return""===$container.find("textarea[name=gv-note-content]").val().trim()?void gv_entry_notes.show_message($submit,GVEntryNotes.text.error_empty_note):($.ajax({url:GVEntryNotes.ajaxurl,isLocal:!0,method:"POST",beforeSend:function(){$container.addClass("gv-processing-note"),$inputs.prop("disabled","disabled"),$submit.data("value",$submit.html()).html(GVEntryNotes.text.processing)},data:{action:"gv_note_add",data:$(this).serialize()}}).done(function(data,textStatus,jqXHR){$submit.html($submit.data("value")),$inputs.prop("disabled",!1),$container.removeClass("gv-processing-note"),!0===data.success?($container.removeClass("gv-no-notes").addClass("gv-has-notes"),$(data.data.html).hide().appendTo($("table tbody",$container)).fadeIn(),gv_entry_notes.setup_checkboxes($container),$inputs.val("").trigger("change")):gv_entry_notes.show_message($submit,data.data.error)}),!1)}};gv_entry_notes.init()}(jQuery);