!function($){var viewConfiguration={startFreshStatus:!1,init:function(){var vcfg=viewConfiguration;vcfg.gvStartFreshButton=$('a[href="#gv_start_fresh"]'),vcfg.gvSelectForm=$("#gravityview_form_id"),vcfg.currentFormId=vcfg.gvSelectForm.val(),vcfg.toggleInitialVisibility(vcfg),vcfg.gvStartFreshButton.on("click",vcfg.startFresh),vcfg.gvSelectForm.change(vcfg.formChange),$("#gravityview_sort_filter").insertAfter($("#gravityview_view_config")),$('a[href="#gv_switch_view"]').on("click",vcfg.switchView),$('a[href="#gv_select_template"]').click(vcfg.selectTemplate),$(".gv-view-types-hover").click(vcfg.selectTemplateHover),$("a[rel*=external]").click(vcfg.openExternalLinks),$("body").on("click",".gv-overlay",function(e){e.preventDefault(),$(".ui-dialog:visible .ui-dialog-titlebar .ui-button").click()}),$("body").on("mouseup keyup",function(e){var close=!1;"keyup"===e.type&&27==e.keyCode&&(close=!0),"mouseup"===e.type&&(!$(e.target).is(".ui-tooltip")&&!$(e.target).parents(".ui-tooltip").length>0||$(e.target).parents(".close").length>0)&&(close=!0),close&&$("a.gv-add-field[data-tooltip='active']").tooltip("close")}),$("body").on("click",".ui-tooltip-content .gv-fields",function(e){$(this).has(".field-id-all-fields").length?vcfg.addAllFields($(this)):vcfg.addField($(this),e)}),$("body").on("click",".gv-shortcode input",vcfg.selectText),$("body").on("change",".gv-dialog-options input[name*=show_as_link]",vcfg.toggleShowAsEntry),$("body").on("click","span.gv-field-controls a[href='#remove']",vcfg.removeField),$("body").on("click","span.gv-field-controls a[href='#settings']",vcfg.openFieldSettings),$("#gravityview_view_config").find(".hndle,.handlediv").off("click").on("click",function(e){return e.preventDefault(),!1}),$("body").on("dblclick",".gv-fields",function(e){vcfg.openFieldSettings(e)}),$(document).on("click","#publish",vcfg.createPresetForm)},toggleShowAsEntry:function(e){var parent=$(e.target).parents(".gv-fields"),icon=parent.find(".gv-field-controls .dashicons-admin-links");$(e.target).is(":checked")?icon.removeClass("hide-if-js"):icon.addClass("hide-if-js")},selectText:function(e){return e.preventDefault(),$(this).focus().select(),!1},toggleInitialVisibility:function(vcfg){0!==vcfg.gvSelectForm.length&&(""===vcfg.currentFormId?vcfg.hideView():$("#gravityview_directory_template").val().length>0?($("#gravityview_select_template").slideUp(150),vcfg.showViewConfig()):(vcfg.templateFilter("custom"),vcfg.showViewTypeMetabox()))},hideView:function(){var vcfg=viewConfiguration;vcfg.currentFormId="",$("#gravityview_view_config, #gravityview_select_template, #gravityview_sort_filter").hide()},toggleViewTypeMetabox:function(){var $templates=$("#gravityview_select_template");$templates.is(":visible")?($("a[href=#gv_switch_view]").text(function(){return $(this).attr("data-text-backup")}),$templates.slideUp(150)):($("a[href=#gv_switch_view]").attr("data-text-backup",function(){return $(this).text()}).text(gvGlobals.label_cancel),$templates.slideDown(150))},showViewTypeMetabox:function(){$("#gravityview_select_template").slideDown(150)},startFresh:function(e){e.preventDefault();var vcfg=viewConfiguration;vcfg.startFreshStatus=!0,""!==vcfg.currentFormId&&vcfg.gvSelectForm.length>0?vcfg.showDialog("#gravityview_form_id_dialog"):vcfg.startFreshContinue()},startFreshContinue:function(){var vcfg=viewConfiguration;$("#gravityview_form_id_start_fresh").val("1"),$("#gravityview_form_id").val(""),$("a[href=#gv_switch_view]").hide(),vcfg.templateFilter("preset"),vcfg.showViewTypeMetabox(),vcfg.hideViewConfig()},formChange:function(e){e.preventDefault();var vcfg=viewConfiguration;vcfg.startFreshStatus=!1,""!==vcfg.currentFormId&&vcfg.currentFormId!==$(this).val()?vcfg.showDialog("#gravityview_form_id_dialog"):vcfg.formChangeContinue()},formChangeContinue:function(){var vcfg=viewConfiguration;""===vcfg.gvSelectForm.val()?vcfg.hideView():($("body").trigger("gravityview_form_change").addClass("gv-form-changed"),vcfg.templateFilter("custom"),vcfg.showViewTypeMetabox(),vcfg.getAvailableFields(),vcfg.getSortableFields(),$("a[href=#gv_switch_view]").fadeOut(150))},showDialog:function(dialogSelector,buttons){var vcfg=viewConfiguration,thisDialog=$(dialogSelector),cancel_button={text:gvGlobals.label_cancel,click:function(){thisDialog.is("#gravityview_form_id_dialog")?(vcfg.startFreshStatus=!1,vcfg.gvSelectForm.val(vcfg.currentFormId)):thisDialog.is("#gravityview_switch_template_dialog")&&(vcfg.toggleViewTypeMetabox(),vcfg.showViewConfig()),thisDialog.dialog("close")}},continue_button={text:gvGlobals.label_continue,click:function(){thisDialog.is("#gravityview_form_id_dialog")?vcfg.startFreshStatus?vcfg.startFreshContinue():vcfg.formChangeContinue():thisDialog.is("#gravityview_switch_template_dialog")&&(vcfg.selectTemplateContinue(),vcfg.toggleViewTypeMetabox()),thisDialog.dialog("close")}},default_buttons=[cancel_button,continue_button];buttons=buttons||default_buttons,thisDialog.dialog({dialogClass:"wp-dialog",appendTo:thisDialog.parent(),draggable:!1,resizable:!1,width:function(){return $(window).width()>550?550:$(window).width()-10},open:function(){return $('<div class="gv-overlay" />').prependTo("#wpwrap"),!0},close:function(e){e.preventDefault(),vcfg.setCustomLabel(thisDialog),$("#wpwrap > .gv-overlay").fadeOut("fast",function(){$(this).remove()})},closeOnEscape:!0,buttons:buttons})},setCustomLabel:function(dialog){var $custom_label=$("[name*=custom_label]",dialog),show_label=$("[name*=show_label]",dialog).is(":checked"),$label=dialog.parents(".gv-fields").find(".gv-field-label");$label.text($custom_label.length&&$custom_label.val().length&&show_label?$custom_label.val():$label.attr("data-original-title"))},getSortableFields:function(context,id){var vcfg=viewConfiguration;$("#gravityview_sort_field").prop("disabled","disabled").empty().append("<option>"+gvGlobals.loading_text+"</option>");var data={action:"gv_sortable_fields_form",nonce:gvGlobals.nonce};void 0!==context&&"preset"===context?data.template_id=id:data.form_id=vcfg.gvSelectForm.val(),$.post(ajaxurl,data,function(response){"false"!==response&&$("#gravityview_sort_field").empty().append(response).prop("disabled",null)})},switchView:function(e){e.preventDefault(),e.stopImmediatePropagation();var vcfg=viewConfiguration;vcfg.templateFilter("custom"),vcfg.toggleViewTypeMetabox()},templateFilter:function(templateType){$(".gv-view-types-module").each(function(){$(this).attr("data-filter")===templateType?$(this).parent().show():$(this).parent().hide()})},selectTemplate:function(e){var vcfg=viewConfiguration;e.preventDefault(),e.stopImmediatePropagation(),vcfg.wantedTemplate=$(this);var currTemplateId=$("#gravityview_directory_template").val(),selectedTemplateId=vcfg.wantedTemplate.attr("data-templateid");""===currTemplateId?($("#gravityview_select_template").slideUp(150),vcfg.selectTemplateContinue()):currTemplateId!=selectedTemplateId?vcfg.showDialog("#gravityview_switch_template_dialog"):(vcfg.toggleViewTypeMetabox(),vcfg.showViewConfig())},selectTemplateContinue:function(){var vcfg=viewConfiguration,selectedTemplateId=vcfg.wantedTemplate.attr("data-templateid");$("#gravityview_directory_template").val(selectedTemplateId).change();var $parent=vcfg.wantedTemplate.parents(".gv-view-types-module");$parent.parents(".gv-grid").find(".gv-view-types-module").removeClass("gv-selected"),$parent.addClass("gv-selected"),vcfg.startFreshStatus?(vcfg.getAvailableFields("preset",selectedTemplateId),vcfg.getPresetFields(selectedTemplateId),vcfg.getSortableFields("preset",selectedTemplateId)):(vcfg.updateActiveAreas(selectedTemplateId),$("a[href=#gv_switch_view]").fadeIn(150),vcfg.toggleViewTypeMetabox())},selectTemplateHover:function(e){e.preventDefault(),e.stopImmediatePropagation(),$(this).find('a[href="#gv_select_template"]').trigger("click")},openExternalLinks:function(){return window.open(this.href),!1},previewTemplate:function(e){e.preventDefault(),e.stopImmediatePropagation();var parent=$(event.currentTarget).parents(".gv-view-types-module");parent.find(".gv-template-preview").dialog({dialogClass:"wp-dialog",appendTo:$("#gravityview_select_template"),width:550,open:function(){$('<div class="gv-overlay" />').prependTo("#wpwrap")},close:function(){$("#wpwrap > .gv-overlay").fadeOut("fast",function(){$(this).remove()})},closeOnEscape:!0,buttons:[{text:gvGlobals.label_close,click:function(){$(this).dialog("close")}}],close:function(){$(this).dialog("option","appendTo",parent)}})},updateActiveAreas:function(template){var vcfg=viewConfiguration;$("#directory-active-fields, #single-active-fields").children().remove();var data={action:"gv_get_active_areas",template_id:template,nonce:gvGlobals.nonce};$.post(ajaxurl,data,function(response){if(response){var content=$.parseJSON(response);$("#directory-header-widgets").html(content.header),$("#directory-footer-widgets").html(content.footer),$("#directory-active-fields").append(content.directory),$("#single-active-fields").append(content.single),vcfg.showViewConfig()}})},getPresetFields:function(template){var vcfg=viewConfiguration;$("#directory-active-fields, #single-active-fields").children().remove();var data={action:"gv_get_preset_fields",template_id:template,nonce:gvGlobals.nonce};$.post(ajaxurl,data,function(response){if(response){var content=$.parseJSON(response);$("#directory-header-widgets").html(content.header),$("#directory-footer-widgets").html(content.footer),$("#directory-active-fields").append(content.directory),$("#single-active-fields").append(content.single),vcfg.showViewConfig()}})},hideViewConfig:function(){$("#gravityview_view_config,#gravityview_sort_filter").slideUp(150)},showViewConfig:function(){var vcfg=viewConfiguration;$("#gravityview_view_config, #gravityview_sort_filter").slideDown(150),vcfg.toggleDropMessage(),vcfg.init_droppables(),vcfg.init_tooltips()},init_tooltips:function(){$(".gv-add-field").tooltip({content:function(){switch($(this).attr("data-objecttype")){case"field":return $("#directory-available-fields").html();case"widget":return $("#directory-available-widgets").html()}},close:function(){$(this).attr("data-tooltip","")},open:function(){$(this).attr("data-tooltip","active").attr("data-tooltip-id",$(this).attr("aria-describedby"))},closeOnEscape:!0,disabled:!0,position:{my:"center bottom",at:"center top-12"},tooltipClass:"top"}).on("mouseout focusout",function(e){e.stopImmediatePropagation()}).click(function(e){e.preventDefault(),e.stopImmediatePropagation(),$(this).tooltip("open"),$(this).attr("title","")})},getAvailableFields:function(context,templateid){var vcfg=viewConfiguration;$("#directory-available-fields, #single-available-fields").find(".gv-fields").remove(),$("#directory-active-fields, #single-active-fields").find(".gv-fields").remove(),vcfg.toggleDropMessage();var data={action:"gv_available_fields",nonce:gvGlobals.nonce};void 0!==context&&"preset"===context?data.template_id=templateid:data.form_id=vcfg.gvSelectForm.val(),$.post(ajaxurl,data,function(response){response&&($("#directory-available-fields").append(response),$("#single-available-fields").append(response))})},addAllFields:function(clicked){clicked.siblings(".gv-fields").each(function(){$(this).trigger("click")}),$("a.gv-add-field[data-tooltip='active']").tooltip("close")},addField:function(clicked,e){e.preventDefault();var vcfg=viewConfiguration,newField=clicked.clone().hide(),areaId=clicked.parents(".ui-tooltip").attr("id"),templateId=$("#gravityview_directory_template").val(),tooltipId=clicked.parents(".ui-tooltip").attr("id"),addButton=$('a.gv-add-field[data-tooltip-id="'+tooltipId+'"]'),data={action:"gv_field_options",template:templateId,area:addButton.attr("data-areaid"),context:addButton.attr("data-context"),field_id:newField.attr("data-fieldid"),field_label:newField.find(".gv-field-label").attr("data-original-title"),field_type:addButton.attr("data-objecttype"),input_type:newField.attr("data-inputtype"),nonce:gvGlobals.nonce};$.ajax({type:"POST",url:ajaxurl,data:data,async:!0,beforeSend:function(){vcfg.disable_publish()},complete:function(){vcfg.enable_publish()}}).done(function(response){newField.append(response),$(".all-merge-tags").remove(),"undefined"!=typeof form&&$("body").not(".gv-form-changed")&&(window.gfMergeTags=new gfMergeTagsObj(form)),$(".gv-dialog-options",newField).length>0&&$(".dashicons-admin-generic",newField).removeClass("hide-if-js"),$('a[data-tooltip-id="'+areaId+'"]').parents(".gv-droppable-area").find(".active-drop").append(newField).end().attr("data-tooltip-id",""),newField.fadeIn(100)}).fail(function(jqXHR){vcfg.enable_publish(),alert(gvGlobals.field_loaderror),console.log(jqXHR)}).always(function(){vcfg.toggleDropMessage()})},enable_publish:function(){$("#publishing-action #publish").prop("disabled",null).removeClass("button-primary-disabled")},disable_publish:function(){$("#publishing-action #publish").prop("disabled","disabled").addClass("button-primary-disabled")},init_droppables:function(){var vcfg=viewConfiguration;$("#directory-fields, #single-fields").find(".active-drop-widget").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-widget",receive:function(event,ui){var sender_area=ui.sender.attr("data-areaid"),receiver_area=$(this).attr("data-areaid");ui.item.find('[name^="widgets['+sender_area+']"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace(sender_area,receiver_area))}),vcfg.toggleDropMessage()}}),$("#directory-fields, #single-fields").find(".active-drop-field").sortable({placeholder:"fields-placeholder",items:"> .gv-fields",distance:2,revert:75,connectWith:".active-drop-field",receive:function(event,ui){if(ui.item.find(".gv-dialog-options").length>0){var sender_area=ui.sender.attr("data-areaid"),receiver_area=$(this).attr("data-areaid");ui.item.find('[name^="fields['+sender_area+']"]').each(function(){var name=$(this).attr("name");$(this).attr("name",name.replace(sender_area,receiver_area))})}vcfg.toggleDropMessage()}})},toggleDropMessage:function(){$(".active-drop").each(function(){$(this).find(".gv-fields").length>0?$(this).find(".drop-message").hide():$(this).find(".drop-message").fadeIn(100)})},removeField:function(e){e.preventDefault();var vcfg=viewConfiguration,area=$(e.currentTarget).parents(".active-drop");if(e.altKey&&$(area).find(".gv-fields").length>1){var remove_all=window.confirm(gvGlobals.remove_all_fields);return void(remove_all&&($(area).find(".gv-fields").remove(),vcfg.toggleDropMessage()))}$(e.currentTarget).parents(".gv-fields").fadeOut("normal",function(){$(this).remove(),vcfg.toggleDropMessage()})},openFieldSettings:function(e){e.preventDefault();var parent,vcfg=viewConfiguration;parent=$(e.currentTarget).is(".gv-fields")?$(e.currentTarget):$(e.currentTarget).parents(".gv-fields"),vcfg.updateVisibilitySettings(e,!0),$("body").on("change",".gv-fields input:checkbox",vcfg.updateVisibilitySettings);var buttons=[{text:gvGlobals.label_close,click:function(){$(this).dialog("close")}}];vcfg.showDialog(parent.find(".gv-dialog-options"),buttons)},updateVisibilitySettings:function(e,first_run){var vcfg=viewConfiguration;first_run=first_run||!1,$parent=$(e.currentTarget).is(".gv-fields")?$(e.currentTarget):$(e.currentTarget).parents(".gv-fields"),vcfg.toggleVisibility($("input:checkbox[name*=show_label]",$parent),$("[name*=custom_label]",$parent),first_run),vcfg.toggleVisibility($("input:checkbox[name*=emailmailto]",$parent),$("[name*=emailsubject],[name*=emailbody]",$parent),first_run),vcfg.toggleVisibility($("input:checkbox[name*=link_to_source]",$parent),$("[name*=source_link_text]",$parent),first_run),$("input:checkbox",$parent).attr("disabled",null),$("input:checkbox[name*=show_as_link]",$parent).is(":checked")&&$("input:checkbox[name*=link_to_]",$parent).attr("disabled",!0),$("input:checkbox[name*=link_to_]:checked",$parent).length>0&&$("input:checkbox[name*=show_as_link]",$parent).attr("disabled",!0),vcfg.toggleVisibility($("input:checkbox[name*=only_loggedin]",$parent),$("[name*=only_loggedin_cap]",$parent),first_run)},toggleVisibility:function($checkbox,$toggled,first_run){var speed=first_run?0:"fast";$checkbox.is(":checked")?$toggled.parents("li").fadeIn(speed):$toggled.parents("li").fadeOut(speed)},createPresetForm:function(){var vcfg=viewConfiguration,templateId=$("#gravityview_directory_template").val();if(!vcfg.startFreshStatus||""===templateId)return!0;var data={action:"gv_set_preset_form",template_id:templateId,nonce:gvGlobals.nonce};return $.post(ajaxurl,data,function(response){"false"!=response?(vcfg.startFreshStatus=!1,vcfg.gvSelectForm.find("option:selected").removeAttr("selected"),vcfg.gvSelectForm.append(response),$("#publish").trigger("click")):$("#post").before('<div id="message" class="error below-h2"><p>'+gvGlobals.label_publisherror+"</p></div>")}),!1}};$(document).ready(function(){$("#title-prompt-text").text(gvGlobals.label_viewname),viewConfiguration.init(),$(".gv-datepicker").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1});var cookie_key="gv-active-tab-"+$("#post_ID").val(),activate_tab=$.cookie(cookie_key);"undefined"===activate_tab&&(activate_tab=0),$("#gv-view-configuration-tabs").tabs({active:activate_tab,activate:function(event,ui){$.cookie(cookie_key,ui.newTab.index(),{path:gvGlobals.cookiepath})}}),$("#gravityview_template_settings .form-table tr:even").addClass("alternate")})}(jQuery);